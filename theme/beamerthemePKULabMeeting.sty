\RequirePackage{tikz}
\usepgflibrary{fadings}

\RequirePackage{iftex}

\AtBeginDocument{\setbeamertemplate{logo}{}}


\newcommand{\PKU@logo}{}
\newcommand{\PKU@supervisor}{}
\newcommand{\PKU@department}{}
\newcommand{\PKU@titlepagelogo}{}
\newcommand{\PKU@titlepagebackground}{}
\newcommand{\PKU@backgroundlogo}{}

\renewcommand{\logo}[1]{\renewcommand{\PKU@logo}{#1}}
%\newcommand{\supervisor}[1]{\renewcommand{\PKU@supervisor}{#1}}
\newcommand{\department}[1]{\renewcommand{\PKU@department}{#1}}
\newcommand{\titlepagelogo}[1]{\renewcommand{\PKU@titlepagelogo}{#1}}
\newcommand{\titlepagebackground}[1]{\renewcommand{\PKU@titlepagebackground}{#1}}
\newcommand{\backgroundlogo}[1]{\renewcommand{\PKU@backgroundlogo}{#1}}


\newcommand{\thanksframe}[1]{{
	\setbeamertemplate{background}{
		\begin{tikzpicture}
			\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
			\fill[PKURed] (0,0) rectangle(\the\paperwidth,\the\paperheight);
		\end{tikzpicture}
	}
	\begin{frame}[c]
	\centering\Large\color{white} #1
	\end{frame}
}}

\definecolor{PKURed}{RGB}{139,0,18}
\definecolor{PKULightRed}{RGB}{198,0,26}
\definecolor{PKUTitleRed}{RGB}{139,0,18}
\definecolor{PKUTextGray}{RGB}{66,66,66}
\definecolor{PKUTitleLineRed}{RGB}{80,0,10}
\definecolor{BackgroundColor}{RGB}{234,234,234}

\setbeamercolor{normal text}{fg=PKUTextGray, bg=}
\setbeamercolor{frametitle}{fg=PKUTitleRed}
\setbeamercolor{footline}{bg=PKURed, fg=white}
\setbeamercolor{section}{parent={footline}}
\setbeamercolor{subsection}{parent={footline}}
\setbeamercolor*{item}{fg=PKULightRed}
\setbeamercolor*{item projected}{bg=PKULightRed}
\setbeamercolor*{enumerate item}{fg=PKULightRed}
\setbeamercolor*{enumerate subitem}{parent={enumerate item}}
\setbeamercolor*{enumerate subsubitem}{parent={enumerate item}}
\setbeamercolor{local structure}{fg=PKULightRed}
\setbeamercolor{title page}{fg=white}
\setbeamercolor{block title}{fg=PKULightRed}
\setbeamercolor{block title example}{fg=PKULightRed}
\setbeamercolor{section in toc}{fg=PKULightRed}
\setbeamercolor{subsection in toc}{fg=PKULightRed}

\setbeamerfont{title}{size=\LARGE}
\setbeamerfont{author}{shape=\itshape}
\setbeamerfont{frametitle}{series=\bfseries}

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{itemize items}[square]
\setbeamertemplate{background canvas}[vertical shading][bottom=BackgroundColor,top=white]

\setbeamertemplate{footline}{
  \leavevmode\hbox{%
    \begin{beamercolorbox}[wd=0.3\paperwidth, ht=0.6cm, dp=1ex, left, leftskip=0.4cm]{section}%
      \ifnum\thepage>1%
      \vfill%
      \PKU@logo%
      \vfill%
      \else%
      \raisebox{0.2cm}{\PKU@department}%
      \fi%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=0.4\paperwidth, ht=0.6cm, dp=1ex, center, sep=0.2cm]{section}%
      \ifnum\thepage>1%
      \insertsectionhead%
      \fi%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=0.3\paperwidth, ht=0.6cm, dp=1ex, right, rightskip=0.4cm]{subsection}%
      \ifnum\thepage>1%
      \raisebox{0.2cm}{\insertframenumber{} / \inserttotalframenumber\hspace*{2ex}}%
      \else%
      \raisebox{0.2cm}{\insertinstitute}%
      \fi%
    \end{beamercolorbox}
  }
}


\setbeamertemplate{background}{%
	\ifnum\thepage>1\relax%
		\begin{tikzpicture}
		\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
		\draw[PKUTitleLineRed] ([yshift=-1.2cm]current page.north west) -- ([yshift=-1.2cm]current page.north east);
        \node[opacity=0.2] at (11, 2.5) {\PKU@backgroundlogo};
		\end{tikzpicture}
	\else%
	\begin{tikzpicture}
		\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
		\fill[color=PKURed] (0,0) rectangle (\the\paperwidth,\the\paperheight);
	\end{tikzpicture}%
	\fi%
}

\setbeamertemplate{title page}{
  \usebeamercolor{title page}
  \begin{tikzpicture}
	\useasboundingbox (1,0) rectangle (\the\paperwidth,\the\paperheight);
	\node[opacity=0.4] at (4, 4) {\PKU@titlepagebackground};

	%\fill[top color=PKULightRed, middle color=PKULightRed, bottom color=MilanoDarkBlue] (0, 6.75) rectangle (\the\paperwidth, 8.75);
    \fill[PKURed, path fading=west] (0, 0) rectangle (9,\the\paperheight);
    %% plot color
    \fill[PKURed] (9, 0) rectangle (\the\paperwidth,\the\paperheight);
    %% plot color
    \fill[PKURed, path fading=south] (0, 3) rectangle (\the\paperwidth,8);
    %% plot color
    \fill[PKURed] (0, 7.5) rectangle (\the\paperwidth,\the\paperheight);
    %% plot color
    \node[right] at (1, 8.5) {\PKU@titlepagelogo};  %% plot logo
	\node[align=center, font=\usebeamerfont{title}] at (6.4, 6.5) {\inserttitle};
	\node[align=center, font=\usebeamerfont{author}] at (6.4, 5.2) {\insertauthor};
    \node[align=center] at (6.4, 4.6) {\insertdate};
	
    %\node[align=left, font=\usebeamerfont{author}, right] at (1.3, 1.4) {\PKU@supervisor};
    %\draw[step=1, help lines] (0,0) grid (\the\paperwidth,\the\paperheight);
  \end{tikzpicture}
}

\setbeamertemplate{frametitle}{
\vspace*{0.1cm}%
\begin{beamercolorbox}{frametitle}
	\usebeamerfont{frametitle}\insertframetitle
\end{beamercolorbox}
}
